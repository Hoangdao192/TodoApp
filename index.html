<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/a914f93d25.js" crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="top-bar">
            <i style="display: none;" class="fa-solid fa-arrow-left back-button"></i>
            <h1 id="app-title">Todo</h1>
            <i id="app-setting" class="fa-solid fa-ellipsis"></i>
        </div>
        <div class="content">

            <div class="main-activity">
                <div class="task">
                    <p class="section-title">Tasks</p>
                    <div class="all-task">

                    </div>
                </div>
                <div class="completed">
                    <p class="section-title">Completed</p>
                    <div class="task-item">
                        <input checked id="checkbox-5" type="checkbox">
                        <label for="checkbox-5">
                            <i class="check-icon fa-xs fa-solid fa-check"></i>
                        </label>
                        <p class="task-short-description">Clear the room</p>
                    </div>
                    <div class="task-item">
                        <input checked id="checkbox-6" type="checkbox">
                        <label for="checkbox-6">
                            <i class="check-icon fa-xs fa-solid fa-check"></i>
                        </label>
                        <p class="task-short-description">Send the finished assignment</p>
                    </div>
                </div>
                <div class="add-button">
                    <i class="fa-solid fa-plus"></i>
                </div>
            </div>

            <div class="add-task-activity">
                <input type="text" placeholder="Title" id="title-input">
                <p placeholder="Description" contenteditable="true" id="desc-input"></p>
                <i class="fa-regular fa-clock"></i>
                <p>Deadline</p>
                <button id="save-task">Save</button>
            </div>
        </div>
    </div>
</body>
<script>
    class Task {
        constructor(id, title, description) {
            this.id = id;
            this.title = title;
            this.description = description;
        }

        get getId() {
            return this.id;
        }

        get getTitle() {
            return this.title;
        }

        get getDesciption() {
            return this.description;
        }
    }

    var addTaskButton = document.querySelector(".add-button");
    var backButton = document.querySelector(".back-button");
    var saveTaskButton = document.getElementById("save-task");

    showMainActivity();

    addTaskButton.addEventListener("click", showAddTaskActivity);
    backButton.addEventListener("click", showMainActivity);
    saveTaskButton.addEventListener("click", createNewTask);

    function showAddTaskActivity() {
        console.log("called");
        var mainActivity = document.querySelector(".main-activity");
        var addTaskActivity = document.querySelector(".add-task-activity");
        if (mainActivity.style.display != "none") {
            mainActivity.style.display = "none";
        }
        if (addTaskActivity.style.display != "block") {
            addTaskActivity.style.display = "block";
        }

        if (backButton.style.display != "inline-block") {
            backButton.style.display = "inline-block";
        }
    }

    function showMainActivity() {
        getAllTask();
        var mainActivity = document.querySelector(".main-activity");
        var addTaskActivity = document.querySelector(".add-task-activity");
        if (addTaskActivity.style.display != "none") {
            addTaskActivity.style.display = "none";
        }
        if (mainActivity.style.display != "block") {
            mainActivity.style.display = "block";
        }
        if (backButton.style.display != "none") {
            backButton.style.display = "none";
        }
    }

    function createNewTask() {
        var inputTitle = document.getElementById("title-input");
        var inputDescription = document.getElementById("desc-input");
        if (inputTitle.value == "") return;

        console.log(inputTitle.value, " + ", inputDescription.innerHTML);

        if (localStorage.getItem("taskArray") == null) {
            var taskArray = [];
            taskArray[0] = new Task(0, inputTitle.value, inputDescription.innerHTML);
            localStorage.setItem("taskArray", JSON.stringify(taskArray));
        } else {
            var taskArray = JSON.parse(localStorage.getItem("taskArray"));
            taskArray.push(new Task(taskArray.length, inputTitle.value, inputDescription.innerHTML));
            localStorage.setItem("taskArray", JSON.stringify(taskArray));
        }
        var taskArray = JSON.parse(localStorage.getItem("taskArray"));
        for (let i = 0; i < taskArray.length; ++i) {
            var task = taskArray[i];
            console.log("Id: ", task.id, " Title: ", task.title);
        }

        console.log(localStorage.getItem("taskArray").toString());
        showMainActivity();
    }

    function getAllTask() {
        var taskArray = JSON.parse(localStorage.getItem("taskArray"));
        var taskContainer = document.querySelector(".all-task");
        taskContainer.innerHTML = "";
        for (let i = 0; i < taskArray.length; ++i) {
            // if (i > 4) break;
            var task = taskArray[i];
            var item = "<div class=\"task-item\">" +
                            "<input style=\"display: none;\" type=\"text\" value=\"" + task.id + "\" id=\"taskId" + task.id + "\">" +
                            "<input id=\"checkbox-" + task.id + "\" type=\"checkbox\">" +
                            "<label for=\"checkbox-" + task.id + "\">" +
                                "<i class=\"check-icon fa-xs fa-solid fa-check\"></i>" +
                            "</label>" +
                            "<p class=\"task-short-description\">" + task.title + "</p>" + 
                            "<i class=\"fa-solid fa-angle-down task-more-infor\"></i>" +
                        "</div>";
            taskContainer.innerHTML += item;
        }
        var taskItems = document.querySelectorAll(".all-task .task-item");
        var taskItemInputs = document.querySelectorAll(".all-task .task-item input[type=\"checkbox\"]");
        for (let i = 0; i < taskItemInputs.length; ++i) {
            taskItemInputs[i].addEventListener('change', function(event) {
                if (event.currentTarget.checked) {
                    deleteTask(taskArray[i].id);
                    taskItems[i].style.animation = 'animation-out 0.3s ease';
                    taskItems[i].addEventListener("animationend", () => {
                        taskItems[i].parentNode.removeChild(taskItems[i]);
                    });
                }
            });
        }   
    }

    function deleteTask(taskId) {
        var taskArray = JSON.parse(localStorage.getItem("taskArray"));
        var taskDelete;
        for (let i = 0; i < taskArray.length; ++i) {
            if (taskArray[i].id == taskId) {
                var temp = taskArray[0];
                taskArray[0] = taskArray[i];
                taskArray[i] = temp;
                taskArray.shift();
                break;
            }
        }
        localStorage.setItem("taskArray", JSON.stringify(taskArray));
    }
</script>

</html>